name: "Nuget"

on:
  workflow_call:
    inputs:
      name:
        required: false
        type: string
      push:
        default: false
        required: false
        type: boolean
      version:
        required: false
        type: string
        default: ${{ github.ref }}
      host:
        required: false
    secrets:
      token:
        required: false
      nuget:
        required: false

jobs:
  release:
    name: Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: false
      - name: Set VERSION variable from tag
        run: |
          echo "VERSION=${{ inputs.tag }}" >> $GITHUB_ENV
          echo "VERSION=${VERSION:1}" >> $GITHUB_ENV
      - name: Build
        run: dotnet build --configuration Release /p:Version=${version}
      - name: Test
        run: dotnet test --configuration Release /p:Version=${VERSION} --no-build
      - name: Pack
        if: inputs.push
        run: dotnet pack --configuration Release /p:Version=${VERSION} --no-build --output .
      - name: Push
        if: inputs.push
        run: dotnet nuget push ${{inputs.name}}.${VERSION}.nupkg -k ${{secrets.nuget}} -s ${{ inputs.host }}
